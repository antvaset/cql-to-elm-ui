(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3369:(e,t,n)=>{Promise.resolve().then(n.bind(n,6940))},6940:(e,t,n)=>{"use strict";n.a(e,async(e,r)=>{try{n.d(t,{CqlCompilerPlayground:()=>p});var o=n(7437),s=n(2265),i=n(7529),d=n(704),a=n(6401),l=n(1439),c=n(5998),u=n(3997),y=n(7924),g=n(5774),m=e([a]);a=(m.then?(await m)():m)[0];let b={cql:"library Test version '0.1.0'\n\nusing FHIR version '4.0.1'\n\ninclude FHIRHelpers version '4.0.1'\n\nvalueset \"Encounter Inpatient\": 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.666.5.307'\n\nparameter \"Measurement Period\" Interval<DateTime>\n\ncontext Patient\n\ndefine \"Inpatient Encounter\":\n  [Encounter: \"Encounter Inpatient\"] EncounterInpatient\n    where EncounterInpatient.status = 'finished'\n      and EncounterInpatient.period ends during day of \"Measurement Period\"\n",useWasm:!1,enableAnnotations:!1,enableLocators:!0,outputContentType:"json",baseUrl:"https://raw.githubusercontent.com/cqframework/cqf-exercises/refs/heads/master/input/cql/"};function p(){let[e,t]=(0,s.useState)({...b,isBusy:!0,output:{type:"log",log:"Getting ready..."},useWorker:!0}),r=(0,s.useRef)(null),m=(0,s.useRef)(null),p=(0,s.useRef)(0);(0,s.useEffect)(()=>{(async()=>{t(e=>({...e,isBusy:!0}));let o=++p.current;if(e.useWorker){let r=(()=>{if(m.current)return m.current;let e=(async()=>{let e=new Worker(n.tu(new URL(n.p+n.u(571),n.b)));return await new Promise(t=>{e.onmessage=e=>{"ready"===e.data.type&&t()}}),e.onmessage=e=>{let{type:n,data:r}=e.data;"output"===n&&r.runId===p.current&&t(e=>({...e,isBusy:"log"===r.output.type,output:r.output}))},e})();return m.current=e,e})();(await r).postMessage({type:"compileCql",data:{args:{cql:e.cql,useWasm:e.useWasm,enableAnnotations:e.enableAnnotations,enableLocators:e.enableLocators,outputContentType:e.outputContentType,baseUrl:e.baseUrl},runId:o}})}else{let{compileCql:n}=(()=>{if(r.current)return r.current;let e=(0,a.P)(!1);return r.current=e,e})();n({cql:e.cql,useWasm:e.useWasm,enableAnnotations:e.enableAnnotations,enableLocators:e.enableLocators,outputContentType:e.outputContentType,baseUrl:e.baseUrl},e=>{o===p.current&&t(t=>({...t,isBusy:"log"===e.type,output:e}))})}})()},[e.cql,e.useWasm,e.enableAnnotations,e.enableLocators,e.outputContentType,e.baseUrl,e.useWorker]);let h=(()=>{if("log"===e.output.type)return e.output.log;if("json"===e.output.contentType)try{return JSON.stringify(JSON.parse(e.output.elm),null,2)}catch(e){console.error(e)}return e.output.elm})(),k=(0,s.useRef)(null),w=(0,s.useRef)(null);return(0,s.useEffect)(()=>{try{let{line:t,col:n}=(0,c.d)(k.current.view.state),r=(0,g.d)(e.output,w.current.view.state.doc.toString(),t,n);r.length?w.current.view.dispatch({selection:u.jT.create(r.map(e=>u.jT.range(e.start,e.end))),effects:y.tk.scrollIntoView(r[0].start,{y:"nearest"})}):w.current.view.dispatch({selection:{anchor:0,head:0}})}catch(e){}},[e.output]),(0,o.jsxs)("div",{style:{position:"absolute",inset:0,padding:20,display:"grid",gridTemplateColumns:"1fr",gridTemplateRows:"auto 1fr",gridTemplateAreas:'"header" "body"',gap:10,minHeight:0},children:[(0,o.jsxs)("div",{style:{display:"flex",gap:20},children:[(0,o.jsx)("h1",{style:{gridArea:"header",margin:0,fontSize:24,flex:"1 0 auto"},children:"CQL Compiler in Kotlin/JS â€” Demo"}),(0,o.jsx)("a",{style:{flex:"0 0 auto"},href:"https://github.com/cqframework/clinical_quality_language/tree/feature-kotlin/Src/js/cql-to-elm-ui",children:"View source"})]}),(0,o.jsxs)("div",{style:{gridArea:"body",display:"grid",gridTemplateColumns:"1fr 1fr",gridTemplateRows:"auto 1fr",gridTemplateAreas:'"body-config body-config" "body-left-editor body-right-editor"',gap:"15px 20px",minHeight:0},children:[(0,o.jsxs)("div",{style:{gridArea:"body-config",display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:20,alignItems:"center"},children:[(0,o.jsxs)("label",{style:{display:"block",gridColumn:"1 / span 2"},children:[(0,o.jsx)("div",{style:{fontWeight:700,margin:"0 0 5px 0"},children:"Library base URL"}),(0,o.jsx)("input",{placeholder:"E.g. https://raw.githubusercontent.com/cqframework/cqf-exercises/refs/heads/master/input/cql/",value:e.baseUrl,onChange:async e=>{let n=e.target.value;t(e=>({...e,baseUrl:n}))},style:{width:"100%",padding:"8px 10px"}})]}),(0,o.jsxs)("div",{style:{gridColumn:"3 / span 2",display:"grid",gap:8},children:[(0,o.jsx)("div",{children:(0,o.jsxs)("div",{style:{display:"flex",gap:5},children:[(0,o.jsx)("div",{style:{fontWeight:700},children:"Compiler options:"}),(0,o.jsxs)("label",{style:{display:"block"},children:[(0,o.jsx)("input",{type:"checkbox",checked:e.enableAnnotations,onChange:e=>{let n=e.target.checked;t(e=>({...e,enableAnnotations:n}))}}),"Enable annotations"]}),(0,o.jsxs)("label",{style:{display:"block"},children:[(0,o.jsx)("input",{type:"checkbox",checked:e.enableLocators,onChange:e=>{let n=e.target.checked;t(e=>({...e,enableLocators:n}))}}),"Enable locators"]})]})}),(0,o.jsxs)("div",{style:{display:"grid",gap:5},children:[(0,o.jsxs)("div",{style:{display:"flex",gap:5,margin:"0 0 2px 0"},children:[(0,o.jsx)("div",{style:{fontWeight:700},children:"Output content type:"}),["json","xml"].map(n=>(0,o.jsxs)("label",{style:{display:"block"},children:[(0,o.jsx)("input",{type:"radio",checked:e.outputContentType===n,onChange:()=>{t(e=>({...e,outputContentType:n}))}}),n.toUpperCase()]},n))]}),(0,o.jsxs)("div",{style:{display:"flex",gap:10},children:[(0,o.jsxs)("label",{style:{display:"block"},children:[(0,o.jsx)("input",{type:"checkbox",checked:e.useWorker,onChange:e=>{let n=e.target.checked;t(e=>({...e,useWorker:n}))}}),"Use worker"]}),(0,o.jsxs)("label",{style:{display:"block"},children:[(0,o.jsx)("input",{type:"checkbox",checked:e.useWasm,onChange:e=>{let n=e.target.checked;t(e=>({...e,useWasm:n}))}}),"Use WASM"]})]})]})]})]}),(0,o.jsxs)("div",{style:{gridArea:"body-left-editor",display:"grid",gridTemplateColumns:"1fr",gridTemplateRows:"auto 1fr",gridTemplateAreas:'"body-left-editor-label" "body-left-editor-textarea"',minHeight:0},children:[(0,o.jsx)("div",{style:{gridArea:"body-left-editor-label"},children:(0,o.jsx)("div",{style:{fontWeight:700,margin:"0 0 5px 0"},children:"Library CQL"})}),(0,o.jsx)(c.M,{ref:k,gridArea:"body-left-editor-textarea",value:e.cql,onChange:e=>{t(t=>({...t,cql:e}))},editable:!0,extensions:[l.v,y.tk.updateListener.of(t=>{if(t.docChanged||t.selectionSet){let{line:t,col:n}=(0,c.d)(k.current.view.state),r=(0,g.d)(e.output,w.current.view.state.doc.toString(),t,n);r.length?w.current.view.dispatch({selection:u.jT.create(r.map(e=>u.jT.range(e.start,e.end))),effects:y.tk.scrollIntoView(r[0].start,{y:"nearest"})}):w.current.view.dispatch({selection:{anchor:0,head:0}})}})]})]}),(0,o.jsxs)("div",{style:{gridArea:"body-right-editor",display:"grid",gridTemplateColumns:"1fr",gridTemplateRows:"auto 1fr",gridTemplateAreas:'"body-right-editor-label" "body-right-editor-textarea"',minHeight:0},children:[(0,o.jsx)("div",{style:{gridArea:"body-right-editor-label"},children:(0,o.jsx)("div",{style:{fontWeight:700,margin:"0 0 5px 0",background:e.isBusy?"url(https://upload.wikimedia.org/wikipedia/en/6/6f/Windows_hourglass_cursor.png) right center/auto no-repeat":"none"},children:"Library ELM"})}),(0,o.jsx)(c.M,{ref:w,gridArea:"body-right-editor-textarea",value:h,onChange:()=>{},editable:!1,extensions:"log"===e.output.type?[]:"json"===e.output.contentType?[(0,i.AV)()]:[(0,d.Ls)()]})]})]})]})}r()}catch(e){r(e)}})},1439:(e,t,n)=>{"use strict";n.d(t,{v:()=>s});var r=n(4241),o=n(2463);let s=r.il.define((0,o.Q)({start:[{regex:/\/\/.*/,token:"comment"},{regex:/\/\*/,token:"comment",next:"comment"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"def"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string-2"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedentIfLineStart:!0},{regex:/\b(context +)(Patient|Population)\b/,token:["keyword",null]},{regex:/\b(predecessor +of|successor +of|singleton +from)\b/,token:"keyword"},{regex:/\b(year|month|day|hour|minute|second|millisecond|timezone|date|time) +from\b/,token:"keyword"},{regex:/\b(years|months|days|hours|minutes|seconds|milliseconds) +between\b/,token:"keyword"},{regex:/\b(width +of|such that)\b/,token:"keyword"},{regex:/\b(Coalesce|is +null|is +not +null)\b/,token:"keyword"},{regex:/\b(difference)( +in +)(years|months|days|hours|minutes|seconds|milliseconds)( +between)\b/,token:["keyword","keyword","keyword","keyword"]},{regex:/\b(start|end)( +of)\b/,token:["keyword","keyword"]},{regex:/\b(properly +)(contains|includes|during|included +in)\b/,token:["keyword","keyword"]},{regex:/\b(contains|includes|during|included +in)\b/,token:["keyword","keyword"]},{regex:/\b(properly +)(between)\b/,token:["keyword","keyword"]},{regex:/\b(same +)(year|month|day|hour|minute|second|millisecond)( +)(or +before|or +after|as)\b/,token:["keyword","keyword",null,"keyword"]},{regex:/\b(same +)(or +before|or +after|as)\b/,token:["keyword","keyword"]},{regex:/\b(properly +)(within +)(\d+)(\s+)(year|month|day|hour|minute|second|millisecond)( +of)\b/,token:["keyword","keyword","number",null,"keyword","keyword"]},{regex:/\b(properly +)(within +)(\d+)(\s+)(years|months|days|hours|minutes|seconds|milliseconds)( +of)\b/,token:["keyword","keyword","number",null,"keyword","keyword"]},{regex:/\b(within +)(\d+)(\s+)(years|months|days|hours|minutes|seconds|milliseconds)( +of)\b/,token:["keyword","number",null,"keyword","keyword"]},{regex:/\b(year|month|day|hour|minute|second|millisecond)( +or +)(less|more)( +)(before|after)\b/,token:["keyword","keyword","keyword",null,"keyword"]},{regex:/\b(years|months|days|hours|minutes|seconds|milliseconds)( +or +)(less|more)( +)(before|after)\b/,token:["keyword","keyword","keyword","keyword","keyword"]},{regex:/\b(year|month|day|hour|minute|second|millisecond)( +)(before|after)\b/,token:["keyword",null,"keyword"]},{regex:/\b(years|months|days|hours|minutes|seconds|milliseconds)( +)(before|after)\b/,token:["keyword",null,"keyword"]},{regex:/\b(CalculateAge)(In)(Years|Months|Days|Hours|Minutes|Seconds)(At)\b/,token:["keyword","keyword","keyword","keyword"]},{regex:/\b(CalculateAge)(In)(Years|Months|Days|Hours|Minutes|Seconds)\b/,token:["keyword","keyword","keyword"]},{regex:/\b(Age)(In)(Years|Months|Days|Hours|Minutes|Seconds)(At)\b/,token:["keyword","keyword","keyword","keyword"]},{regex:/\b(Age)(In)(Years|Months|Days|Hours|Minutes|Seconds)\b/,token:["keyword","keyword","keyword"]},{regex:/\b(sort +)(ascending|descending)( +by)(.*)(ascending|descending)\b/,token:["keyword","keyword","keyword",null,"keyword"]},{regex:/\b(sort +)(asc|desc)( +by)(.*)(asc|desc)\b/,token:["keyword","keyword","keyword",null,"keyword"]},{regex:/\b(sort +)(by)(.*)(ascending|descending)\b/,token:["keyword","keyword",null,"keyword"]},{regex:/\b(sort +)(by)(.*)(asc|desc)\b/,token:["keyword","keyword",null,"keyword"]},{regex:/\b(by)(.*)(ascending|descending)\b/,token:["keyword",null,"keyword"]},{regex:/\b(by)(.*)(asc|desc)\b/,token:["keyword",null,"keyword"]},{regex:/\B\@\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}\b/,token:"tag"},{regex:/\B\@\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\b/,token:"tag"},{regex:/\B\@\d{4}-\d{2}-\d{2}T\d{2}:\d{2}\b/,token:"tag"},{regex:/\B\@\d{4}-\d{2}-\d{2}T\d{2}\b/,token:"tag"},{regex:/\B\@\d{4}-\d{2}-\d{2}\b/,token:"tag"},{regex:/\B\@\d{4}-\d{2}\b/,token:"tag"},{regex:/\B\@\d{4}\b/,token:"tag"},{regex:/\B\@T\d{2}:\d{2}:\d{2}\b/,token:"tag"},{regex:/\B\@T\d{2}:\d{2}:\d{2}\b/,token:"tag"},{regex:/\B\@T\d{2}:\d{2}\b/,token:"tag"},{regex:/\B\@T\d{2}\b/,token:"tag"},{sol:!0,regex:/(after|all|and|as|asc|ascending|before|between|by|called|case|cast|codesystem|codesystems|collapse|contains|convert|day|days|default|define|desc|descending|difference|display|distinct|div|duration|during|else|end|ends|except|exists|flatten|from|function|hour|hours|if|implies|in|include|includes|intersect|is|let|library|maximum|meets|millisecond|milliseconds|minimum|minute|minutes|mod|month|months|not|occurs|of|or|overlaps|parameter|predecessor|private|public|return|same|singleton|second|seconds|start|starts|successor|then|to|union|using|valueset|version|week|weeks|where|when|with|within|without|xor|year|years)\b/,token:"keyword"},{regex:/(\w\W|\W)(after|all|and|as|asc|ascending|before|between|by|called|case|cast|codesystem|codesystems|collapse|contains|convert|day|days|default|define|desc|descending|difference|display|distinct|div|duration|during|else|end|ends|except|exists|flatten|from|function|hour|hours|if|implies|in|include|includes|intersect|is|let|library|maximum|meets|millisecond|milliseconds|minimum|minute|minutes|mod|month|months|not|occurs|of|or|overlaps|parameter|predecessor|private|public|return|same|singleton|second|seconds|start|starts|successor|then|to|union|using|valueset|version|week|weeks|where|when|with|within|without|xor|year|years)\b/,token:[null,"keyword"]},{sol:!0,regex:/(Any|Boolean|Code|Concept|DateTime|Decimal|Integer|Interval|List|Quantity|String|Time|Tuple|AllTrue|AnyTrue|Avg|Count|Max|Min|Median|Mode|PopulationStdDev|PopulationVariance|StdDev|Sum|Variance|First|IndexOf|Last|Length|Now|TimeOfDay|Today|Combine|Length|Lower|PositionOf|Split|Substring|Upper|Abs|Ceiling|Floor|Log|Ln|Round|Truncate|ToBoolean|ToConcept|ToDateTime|ToDecimal|ToInteger|ToQuantity|ToString|ToTime)\b/,token:"builtin"},{regex:/(\w\W|\W)(Any|Boolean|Code|Concept|DateTime|Decimal|Integer|Interval|List|Quantity|String|Time|Tuple|AllTrue|AnyTrue|Avg|Count|Max|Min|Median|Mode|PopulationStdDev|PopulationVariance|StdDev|Sum|Variance|First|IndexOf|Last|Length|Now|TimeOfDay|Today|Combine|Length|Lower|PositionOf|Split|Substring|Upper|Abs|Ceiling|Floor|Log|Ln|Round|Truncate|ToBoolean|ToConcept|ToDateTime|ToDecimal|ToInteger|ToQuantity|ToString|ToTime)\b/,token:[null,"builtin"]},{sol:!0,regex:/(true|false|null)\b/,token:"atom"},{regex:/\d/i,token:"number"},{regex:/(\w\W|\W)(true|false|null)\b/,token:[null,"atom"]}],comment:[{regex:/.*?\*\//,token:"comment",next:"start"},{regex:/.*/,token:"comment"}],meta:{dontIndentStates:["comment"],lineComment:"//"}}))},5998:(e,t,n)=>{"use strict";n.d(t,{M:()=>d,d:()=>a});var r=n(7437),o=n(2265),s=n(3997),i=n(7924);let d=(0,o.forwardRef)((e,t)=>{let{gridArea:n,value:o,onChange:d,editable:a,extensions:l}=e;return(0,r.jsx)(s.ZP,{ref:t,style:{gridArea:n,minWidth:0,minHeight:0,background:"white",border:"1px solid #777",borderRadius:2.5},height:"100%",width:"100%",editable:a,theme:i.tk.theme({".cm-content":{padding:"8px 0"},".cm-line":{padding:"0 10px"}}),basicSetup:{allowMultipleSelections:!0,foldGutter:!1,highlightActiveLine:!1,highlightActiveLineGutter:!1,highlightSelectionMatches:!1,lineNumbers:!0,searchKeymap:!1},value:o,extensions:[i.tk.lineWrapping,...l],onChange:d})});function a(e){let t=e.selection.main.head,n=e.doc.lineAt(t);return{line:n.number,col:t-n.from+1}}},5774:(e,t,n)=>{"use strict";function r(e,t,n,r){return"log"===e.type?[]:"json"===e.contentType?o(t,n,r,/"locator": "(\d+):(\d+)-(\d+):(\d+)"/g):o(t,n,r,/locator="(\d+):(\d+)-(\d+):(\d+)"/g)}function o(e,t,n,r){return[...e.matchAll(r).filter(e=>{let[r,o,s,i]=e.slice(1).map(Number);if((r<t||r===t&&o<=n)&&(s>t||s===t&&i>=n))return!0}).map(e=>({start:e.index,end:e.index+e[0].length}))]}n.d(t,{d:()=>r})}},e=>{var t=t=>e(e.s=t);e.O(0,[663,401,103,226,327,130,215,744],()=>t(3369)),_N_E=e.O()}]);